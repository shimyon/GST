@{
    Layout = "_Layout.cshtml";
}


@*<div class="sechead pb5 fs14 mt20 "><b>Quotation</b></div>*@
<div class="mt-5">
    <ul id="myTab" class="nav nav-tabs">
        <li class="active"><a class="nav-link" href="#Invoice" data-toggle="tab" aria-selected="true">Invoice</a></li>

        <li><a class="nav-link" href="#Template" data-toggle="tab">Template</a></li>
    </ul>

    <div id="Content" class="tab-content">
        <div class="tab-pane fade in active" id="Invoice">
            <div class="row">
                <div class="col-md-4">
                    <div class="form-group">
                        <label>Company Name</label>
                        <select class="form-control" id="CompanyName">
                            <option value="CompanyName">Select Company</option>
                        </select>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="form-group">
                        <label>Contact Name</label>
                        <select class="form-control" id="ContactName">
                            <option value="">Select Contact</option>
                        </select>
                    </div>
                </div>
                <div class="col-md-4 ">
                    <div class="form-group">
                        <label for="inputAddress2">Invoice Date</label>
                        <input type="date" class="form-control" id="InvoiceDate">
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col col-md-1">
                    <button type="button" class="btn btn-primary" onclick="saveInvoiceData();">Save</button>
                </div>
                <div class="col col-md-1">
                    <button type="button" class="btn btn-danger" onclick="goBack();">Cancel</button>
                </div>
            </div>
        </div>


        <div class="tab-pane fade in active" id="Template">
            <div class="row">
                <div class="col-md-4">
                    <div class="form-group">
                        <label>Template Name</label>
                        <select class="form-control" id="tmpInvoice" onchange="GetTemplateById()">
                            <option value="0">Select Template</option>
                        </select>
                    </div>
                </div>
            </div>
            <div class="row">
                <div>
                    <textarea name="TemplateData" id="TemplateData" rows="10" cols="80"></textarea>
                </div>
            </div>
            <div class="row mt-5">
                <div class="col">
                    <button type="button" class="btn btn-primary" onclick="PrintPDF();">Print</button>
                </div>
            </div>
        </div>
    </div>
   
</div>






@section scripts {
<script src="~/Content/ckeditor/ckeditor/ckeditor.js"></script>
    <script type="text/javascript">
        var id = querySt("id");

         $(function () {
             CKEDITOR.replace('TemplateData');
             init();
             $('a[href="#Invoice"]').click();
        })

        async function init() {
            await CompanyDropDownAll();
            await ContactDropDownAll();
            await templateDropDownAll();
            if (id) {
                    GetById();
             }
        }

       function CompanyDropDownAll() {
            return new Promise((result, error) => {
                ajaxcall.get({
                    url: AppConfig.ApiPath + "Company/CompanyDropDownAll"
                }).then((res) => {
                    if (res) {
                        for (var i in res) {
                            $("<option>").val(res[i].value).text(res[i].label).appendTo("#CompanyName");
                        }
                    }
                    result();
                }, err => error(err));
            });
        }

        function ContactDropDownAll() {
            return new Promise((result, error) => {
                ajaxcall.get({
                    url: AppConfig.ApiPath + "Contact/ContactDropDownAll"
                }).then((res) => {
                    if (res) {
                        for (var i in res) {
                            $("<option>").val(res[i].value).text(res[i].label).appendTo("#ContactName");
                        }
                    }
                    result();
                }, err => error(err));
            });
        }

         function templateDropDownAll() {
            return new Promise((result, error) => {
                ajaxcall.get({
                    url: AppConfig.ApiPath + "Template/GetTemplatesByGroup?templateFor=Invoice"
                }).then((res) => {
                    if (res) {
                        for (var i in res) {
                            $("<option>").val(res[i].value).text(res[i].label).appendTo("#tmpInvoice");
                        }
                    }
                    result();
                }, err => error(err));
            });
        }

         function GetTemplateById() {
            CKEDITOR.instances['TemplateData'].setData('');
            if ($("#tmpInvoice").val() == "0") {
                return false;
            }
            ajaxcall.post({
                url: AppConfig.ApiPath + "Template/GetById",
                data: {
                    Id: $("#tmpInvoice").val()
                }
            }).then((res) => {
                if (res) {
                    CKEDITOR.instances['TemplateData'].setData(res.TemplateData);
                }
            }, err => alert(err));
        }

        function PrintPDF(){
                ajaxcall.post({
                            url: AppConfig.ApiPath + "Print",
                            data: {
                                Id: id,
                                TemplateFor: $("#tmpInvoice").val(),
                                TemplateData: $("#TemplateData").val(),
                            }
                        }).then(res => {
                            alert("Saved successfully");
                        }, err => {
                            alert(err.responseJSON);
                        })

        }


        function GetById() {
            ajaxcall.post({
                url: AppConfig.ApiPath + "Invoice/GetById",
                data: { "Id": id }
            }).then(function (res) {
        console.log(res.DOB);
        const newdate = new Date(res.DOB);
        const dateValue = newdate.toLocaleDateString();

                if (res) {
                    $("#CompanyName").val(res.CompanyID);
                    $("#ContactName").val(res.ContactID);
                    $("#InvoiceDate").val(res.InvoiceDateformate);
                }

            })
        }

        function saveInvoiceData(){
             ajaxcall.post({
                    url: AppConfig.ApiPath + "Invoice/AddData",
                    data: {
                        CompanyName: $("#CompanyName").val(),
                        ContactName: $("#ContactName").val(),
                        InvoiceDate: $("#InvoiceDate").val()
                    }

                }).then(res => {
        console.log(res);
                    //QuotID = res;
                    alert("Saved successfully");
                }, err => {
                    alert(err.responseJSON);
                })


        }

         function goBack() {
                 window.history.back();
        }

    </script>
}
